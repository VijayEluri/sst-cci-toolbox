### delete database content, create indexes

delete from mm_coincidence;
delete from mm_datafile;
delete from mm_dataschema;
delete from mm_matchup;
delete from mm_observation;
delete from mm_variable;

create index geo on mm_observation using gist(location);
create index tempo on mm_observation ( time );
vacuum analyse mm_observation;


### number of observations

select o.sensor, count(*) from mm_observation o group by o.sensor order by o.sensor;

select date(o.time), count(*) from mm_observation o group by date(o.time) order by date(o.time);

select o.sensor, date(o.time), count(*) from mm_observation o group by o.sensor, date(o.time) order by date(o.time), o.sensor;


### number of matchups

select count(*) from  mm_matchup m;

select o.sensor, count(m) from mm_matchup m, mm_observation o where m.refobs_id = o.id group by o.sensor order by o.sensor;

select date(o.time), count(*) from mm_matchup m, mm_observation o where m.refobs_id = o.id group by date(o.time) order by date(o.time);


### number of triples, number of coincidences per reference and coincidence sensor

select 'atsr-metop-seviri', count(m) from mm_matchup m where m.pattern & 7 = 7;
select 'atsr-metop', count(m) from mm_matchup m where m.pattern & 7 = 3;
select 'atsr-seviri', count(m) from mm_matchup m where m.pattern & 7 = 5;
select 'metop-seviri', count(m) from mm_matchup m where m.pattern & 7 = 6;
select 'atsr', count(m) from mm_matchup m where m.pattern & 7 = 1;
select 'metop', count(m) from mm_matchup m where m.pattern & 7 = 2;
select 'seviri', count(m) from mm_matchup m where m.pattern & 7 = 4;
select 'atsr-avhrr/pmw', count(m) from mm_matchup m where m.pattern & 7 = 1 and m.pattern & 56 != 0;
select 'metop-avhrr/pmw', count(m) from mm_matchup m where m.pattern & 7 = 2 and m.pattern & 56 != 0;
select 'seviri-avhrr/pmw', count(m) from mm_matchup m where m.pattern & 7 = 4 and m.pattern & 56 != 0;

select m.pattern, count(m) from mm_matchup m group by m.pattern order by m.pattern;

select count(m) 
from  mm_matchup m, mm_observation o, mm_coincidence c1, mm_observation o1, mm_coincidence c2, mm_observation o2
where m.refobs_id = o.id 
and c1.matchup_id = m.id and c1.observation_id = o1.id 
and c2.matchup_id = m.id and c2.observation_id = o2.id 
and o.sensor = 'aatsr-md' and o1.sensor = 'metop' and o2.sensor = 'seviri';

select o.sensor, o1.sensor, count(m) 
from  mm_matchup m, mm_observation o, mm_coincidence c1, mm_observation o1
where m.refobs_id = o.id 
and c1.matchup_id = m.id and c1.observation_id = o1.id 
group by o.sensor, o1.sensor
order by o.sensor, o1.sensor;

### matchup validation

1. Find matchup id with, e.g:

   id from mm_matchup where pattern & 31 = 31 order by id asc;

2. Dump shape files with (there is a shell script for this in the src/main/bin)

   pgsql2shp -h 10.3.0.35 -u mms -f matchup703201-amsre -P mms mmdb "select o.location from mm_observation o, mm_matchup m, mm_coincidence c where m.id = 703201 and c.matchup_id = m.id and c.observation_id = o.id and o.sensor = 'amsre'"
   pgsql2shp -h 10.3.0.35 -u mms -f matchup703201-avhrr -P mms mmdb "select o.location from mm_observation o, mm_matchup m, mm_coincidence c where m.id = 703201 and c.matchup_id = m.id and c.observation_id = o.id and o.sensor = 'avhrr'"
   pgsql2shp -h 10.3.0.35 -u mms -f matchup703201-aatsr -P mms mmdb "select o.location from mm_observation o, mm_matchup m, mm_coincidence c where m.id = 703201 and c.matchup_id = m.id and c.observation_id = o.id and o.sensor = 'aatsr'"
   pgsql2shp -h 10.3.0.35 -u mms -f matchup703201-mds -P mms mmdb "select o.location from mm_observation o, mm_matchup m, mm_coincidence c where m.id = 703201 and c.matchup_id = m.id and c.observation_id = o.id and (o.sensor = 'metop' or o.sensor = 'seviri')"
   pgsql2shp -h 10.3.0.35 -u mms -f matchup703201-ref -P mms mmdb "select o.location from mm_observation o, mm_matchup m where m.id = 703201 and m.refobs_id = o.id"

3. Display shape files with udig
