#!/bin/bash

# fetch changes from github
currentdir=`pwd`
cd ${mms.github} && git pull
cd ${currentdir}

#commithash=`git log --abbrev-commit -1 --pretty=%H`
#commithash=`git log --abbrev-commit -1 --pretty=%h`

# build new software version
mvn -f ${mms.github}/pom.xml clean package assembly:assembly

# remove old software version
echo removing ${mms.home}
rm -rf ${mms.home}

# move assembly to target directory
echo copying data to $(dirname ${mms.home})
mv ${mms.github}/target/sst-cci-mms-${project.version}-bin/sst-cci-mms-${project.version} $(dirname ${mms.home})

# change file permissions manually because maven assembly does not do this
chmod -R ug+X ${mms.home}

cp -f ${mms.home}/bin/mymms ${HOME}/bin
mv -f ${mms.home}/bin/mymmsinstall ${HOME}/bin
